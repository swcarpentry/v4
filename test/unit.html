---
layout: v4_topic
title: Unit Testing
lesson_title: Testing
prev: v4/test/except.html
next: v4/test/interface.html
uplink: v4/test/index.html
pdf: v4/test/unit.pdf
ppt: v4/test/unit.ppt
youtube: {"slug": "9sOwRxhi32w", "time": "00:06:11.50"}
---
<div class="transcript">
  <div class="media">
    <img class="media-object pull-left" src="unit/001.png" />
    <p class="media-body">Hello, and welcome to the third episode of the Software Carpentry lecture on testing.  In this episode, we'll look at how to do unit testing a bit more systematically.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/002.png" />
    <p class="media-body">Our research group is studying the impact of climate change on agriculture.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/003.png" />
    <p class="media-body">We have several thousand aerial photographs of farms taken in the early 1980s.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/004.png" />
    <p class="media-body">We want to compare those with photographs of the same fields taken since 2007 to see what has changed.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/005.png" />
    <p class="media-body">The first step is to find regions where fields overlap.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/006.png" />
    <p class="media-body">Luckily, the area we're looking at is in Saskatchewan&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/007.png" />
    <p class="media-body">&hellip;where fields actually are rectangular.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/008.png" />
    <p class="media-body">A student intern has written a function that finds the overlap between two rectangles.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/009.png" />
    <p class="media-body">Having used student code before, we want to test it before putting it into production.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/010.png" />
    <p class="media-body">We also think we might have to make the function faster, to handle larger data sets&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/011.png" />
    <p class="media-body">&hellip;so we want to have tests in place so that our optimizations don't break anything.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/012.png" />
    <p class="media-body">We're going to use a Python library called Nose to organize our tests.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/013.png" />
    <p class="media-body">In Nose, each test is a function&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/014.png" />
    <p class="media-body">&hellip;whose name begins with the letters <code>test_</code>.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/015.png" />
    <p class="media-body">We can group tests together in files&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/016.png" />
    <p class="media-body">&hellip;whose names also begin with the letters <code>test_</code>.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/017.png" />
    <p class="media-body">To execute our tests, we run the command <code>nosetests</code>.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/018.png" />
    <p class="media-body">This automatically searches the current directory and its sub-directories for test files, and runs the tests they contain.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/019.png" />
    <p class="media-body">To see how this works, let's look at how we'd use it to test the <code>dna_starts_with</code> function from the previous episode.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/020.png" />
    <p class="media-body">Here are our first three tests.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/021.png" />
    <p class="media-body">To help us understand our own tests, we give each function a meaningful name&mdash;something better than "test 1" or "test 2".</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/022.png" />
    <p class="media-body">Each test function uses <code>assert</code> to check the result of a single call to <code>dna_starts_with</code>.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/023.png" />
    <p class="media-body">Test functions can create and use local variables, just like other functions.  It's particularly helpful to put temporary values, or values that are used in several places, in variables to avoid typing mistakes.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/024.png" />
    <p class="media-body">Of course, the Nose library can't think of test cases for us.  We still have to decide what to test, and how many tests to run.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/025.png" />
    <p class="media-body">This brings up an important point.  We know that we should test lots of different cases&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/026.png" />
    <p class="media-body">&hellip;but how many is "lots"?</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/027.png" />
    <p class="media-body">It turns out that's not actually the right question to ask.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/028.png" />
    <p class="media-body">A better question is, how can we choose tests that are worth writing and running?</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/029.png" />
    <p class="media-body">For example, if <code>dna_starts_with('atc', 'a')</code> works, there's probably not much point testing <code>dna_starts_with('ttc', 't')</code>: it's hard to think of a bug that would show up in one case, but not in the other.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/030.png" />
    <p class="media-body">We should therefore try to choose tests that are as different from each other as possible, so that we force the code we're testing to execute in all the different ways it can.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/031.png" />
    <p class="media-body">Another way of thinking about this is that we should try to find <em>boundary cases</em>.  After all, if a function works for zero, one, and a million values, it will probably work for eighteen values.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/032.png" />
    <p class="media-body">Let's apply this idea to our overlapping rectangles problem.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/033.png" />
    <p class="media-body">Here's a "normal" case: two rectangles that overlap by half in each direction.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/034.png" />
    <p class="media-body">What other tests would be useful?</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/035.png" />
    <p class="media-body">Take a moment and see what other tests you can think of.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/036.png" />
    <p class="media-body">Welcome back.  Here's our first test case: two rectangles that overlap by half in each direction..</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/037.png" />
    <p class="media-body">Here's our second: the rectangle on the left extends above and below the one on the right, so none of the corners of the left rectangle are involved.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/038.png" />
    <p class="media-body">Here's a third case: the two rectangles are exactly the same width, but have different vertical extents.  This will tell us whether the overlap function behaves correctly when rectangles intersect along entire lines, rather than just crossing at points.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/039.png" />
    <p class="media-body">And here's a fourth case: the second rectangle is contained entirely within the first, so their edges don't actually cross at all.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/040.png" />
    <p class="media-body">But what do we expect in this case?  How should the function behave if the two rectangles share an edge, but their areas don't overlap?</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/041.png" />
    <p class="media-body">And what if they only share a corner, like this?  Should the function we're testing tell us that these rectangles don't overlap?  Should it return a point, rather than a rectangle?  Or should it return a rectangle with zero area?</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/042.png" />
    <p class="media-body">Thinking about tests in terms of boundary cases helps us find examples like this, where it isn't immediately obvious what the "right" answer is.  Writing those tests forces us to define how the function we're testing is supposed to behave&mdash;i.e., what correct behavior actually is.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/043.png" />
    <p class="media-body">Let's turn all of this into working code.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/044.png" />
    <p class="media-body">Here's a test for the case where rectangles only touch at a corner.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/045.png" />
    <p class="media-body">As you can see, we've decided that this doesn't count as overlap.  Our test is an unambiguous, runnable answer to our question about how the function is supposed to behave.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/046.png" />
    <p class="media-body">Here's our second test: two rectangles that have exactly the same extent, so their overlap is the same again.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/047.png" />
    <p class="media-body">This wasn't actually in the set of test cases we came up with earlier, but it's still a good test.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/048.png" />
    <p class="media-body">And here's a third test, where one rectangle is skinnier than another.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/049.png" />
    <p class="media-body">This test case actually turned up a bug in the first version of the overlap function that we wrote.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/050.png" />
    <p class="media-body">Here's the function.  It takes the coordinates of each rectangle as input, unpacks them to get the high and low X and Y coordinates of each rectangle, checks to make sure that the rectangles actually overlap, then calculates the coordinates of the overlap and returns the result as a new rectangle.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/051.png" />
    <p class="media-body">Take a few moments and see if you can spot the bug.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/052.png" />
    <p class="media-body">It's here&mdash;we're comparing the low Y coordinate of one rectangle with the high X coordinate of the other.  This bug is probably the result of copying and pasting.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/053.png" />
    <p class="media-body">Stepping back, the most important lesson in this episode isn't the details of the Nose library.  It's that your time is more valuable than the computer's, so you should spend it doing the things the computer can't, like thinking of interesting test cases and what your code is actually supposed to do.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/054.png" />
    <p class="media-body">Nose and other libraries like it are there to handle all the things that you <em>shouldn't</em> have to re-think each time.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/055.png" />
    <p class="media-body">They will also help guide you toward good practices, to make your testing and programming more productive.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="unit/056.png" />
    <p class="media-body">In the next episode, we'll look at some of the other ways Nose can help you.</p>
  </div>
</div>
